{# Template programming within this file falls under the project licence.
   Original text of the source file taken from ChibiOS and remains under the
   licence shown below. #}
{% macro pin_attr(attr, pin) %}PIN_{{attr}}_{{pin[attr|lower]}}(GPIO{{pin.port}}_{{pin.name}}){% endmacro %}
{% macro pin_af(pin) %}PIN_AFIO_AF(GPIO{{pin.port}}_{{pin.name}}, {{pin.af}}U){% endmacro %}
/*
    ChibiOS - Copyright (C) 2006..2016 Giovanni Di Sirio
    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at
    http://www.apache.org/licenses/LICENSE-2.0
    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/

/*
    Generated by gen-board.h.py based on {{yamlfile}}
*/

#ifndef _BOARD_H_
#define _BOARD_H_


/*
    Setup for {{name}}
*/

/*
    Board identifier
*/
#define BOARD_{{name|format_board_name}}
#define BOARD_NAME                     "{{name}}"

/*
    Board oscillators-related settings.
*/
#if !defined(STM32_LSECLK)
#define STM32_LSECLK                   {{lsefreq}}U
#endif

#if !defined(STM32_HSECLK)
#define STM32_HSECLK                   {{hsefreq}}U
#endif

/*
    Board voltages
    Required for performance limits calculation.
*/
#define STM32_VDD                      {{voltage}}U

/*
    MCU type as defined in the ST header.
*/
#define {{mcutype}}

{% if other %}
/*
    Other settings.
*/
{% for key, val in other.items() %}
{{"#define {:<30} {}".format(key, val or '')}}
{% endfor %}
{% endif %}

/*
    IO pins assignments.
*/
{% for port in pins.ports() %}
  {% for pin in pins.port(port) %}
{{"#define GPIO{}_{:<24} {}U".format(pin.port, pin.name, pin.num)}}
  {% endfor %}

{% endfor %}
/*
    IO lines assignments.
*/
{% for pin in pins.names() %}
{{"#define LINE_{:<25} PAL_LINE(GPIO{}, {}U)".format(pin.name, pin.port, pin.num)}}
{% endfor %}

/*
    I/O ports initial setup, this configuration is established soon after reset
    in the initialization code.
     Please refer to the STM32 Reference Manual for details.
*/
#define PIN_MODE_INPUT(n)              (0U << ((n) * 2U))
#define PIN_MODE_OUTPUT(n)             (1U << ((n) * 2U))
#define PIN_MODE_ALTERNATE(n)          (2U << ((n) * 2U))
#define PIN_MODE_ANALOG(n)             (3U << ((n) * 2U))
#define PIN_OD_LOW(n)                  (0U << (n))
#define PIN_OD_HIGH(n)                 (1U << (n))
#define PIN_OTYPE_PUSHPULL(n)          (0U << (n))
#define PIN_OTYPE_OPENDRAIN(n)         (1U << (n))
#define PIN_OSPEED_VERYLOW(n)          (0U << ((n) * 2U))
#define PIN_OSPEED_LOW(n)              (1U << ((n) * 2U))
#define PIN_OSPEED_MEDIUM(n)           (2U << ((n) * 2U))
#define PIN_OSPEED_HIGH(n)             (3U << ((n) * 2U))
#define PIN_PUPD_FLOATING(n)           (0U << ((n) * 2U))
#define PIN_PUPD_PULLUP(n)             (1U << ((n) * 2U))
#define PIN_PUPD_PULLDOWN(n)           (2U << ((n) * 2U))
#define PIN_AFIO_AF(n, v)              ((v) << (((n) % 8U) * 4U))

{% for port in pins.ports() %}
/*
 *  GPIO{{port}} setup:
 *
  {% for pin in pins.port(port) %}
{{" * P{}{:<3}- {:<29}({}).".format(pin.port, pin.num, pin.name, pin.raw)}}
  {% endfor %}
*/
  {% for mode in pins.modes %}
    {% for pin in pins.port(port) %}
      {% if loop.first %}
{{"#define VAL_GPIO{}_{:<20} (".format(port, mode + 'R')}}{{ pin_attr(mode, pin) }} | \
      {% elif loop.last %}
                                        {{pin_attr(mode, pin)}})
      {% else %}
                                        {{pin_attr(mode, pin)}} | \
      {% endif %}
    {% endfor %}

  {% endfor %}
  {% for pin in pins.port(port) if pin.num < 8 %}
      {% if loop.first %}
#define VAL_GPIO{{port}}_AFRL                 ({{pin_af(pin)}} | \
      {% elif loop.last %}
                                        {{pin_af(pin)}})
      {% else %}
                                        {{pin_af(pin)}} | \
      {% endif %}
  {% endfor %}

  {% for pin in pins.port(port) if pin.num >= 8 %}
      {% if loop.first %}
#define VAL_GPIO{{port}}_AFRH                 ({{pin_af(pin)}} | \
      {% elif loop.last %}
                                        {{pin_af(pin)}})
      {% else %}
                                        {{pin_af(pin)}} | \
      {% endif %}
  {% endfor %}

{% endfor %}
#if !defined(_FROM_ASM_)
#ifdef __cplusplus
extern "C" {
#endif
  void boardInit(void);
#ifdef __cplusplus
}
#endif
#endif /* _FROM_ASM_ */

#endif /* _BOARD_H_ */
